
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Getting started &#8212; Arepo 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Simulation examples" href="simtypes.html" />
    <link rel="prev" title="Arepo documentation" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="getting-started">
<h1>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<section id="library-requirements">
<h2>Library requirements<a class="headerlink" href="#library-requirements" title="Permalink to this headline">¶</a></h2>
<p>Arepo requires the following libraries for compilation:</p>
<p>Always needed:</p>
<ol class="arabic simple">
<li><p><strong>mpi</strong> The <cite>Message Passing Interface</cite>, version 2.0 or higher.  In
practice Arepo is well-tested on the open source libraries MPICH
&lt;<a class="reference external" href="https://www.mpich.org">https://www.mpich.org</a>&gt; and OpenMPI &lt;<a class="reference external" href="http://www.open-mpi.org">http://www.open-mpi.org</a>&gt;.  For
some machines, vendor supplied versions may exist and can also be
used.  Arepo relies exclusively on MPI for its parallelization.</p></li>
<li><p><strong>gsl</strong> <cite>The GNU Scientific Library</cite>. This open-source library is available
under &lt;<a class="reference external" href="http://www.gnu.org/software/gsl">http://www.gnu.org/software/gsl</a>&gt;.</p></li>
</ol>
<p>Needed in some cases:</p>
<ol class="arabic simple" start="3">
<li><p><strong>fftw3</strong> <cite>Fastest Fourier Transform in the West</cite>
(&lt;<a class="reference external" href="http://www.fftw.org">http://www.fftw.org</a>&gt;) This free software package for
fast-fourier-transformations is used in the particle-mesh
algorithm. Consequently, it is only needed if <code class="docutils literal notranslate"><span class="pre">PMGRID</span></code> is set in
<code class="docutils literal notranslate"><span class="pre">Config.sh</span></code>.</p></li>
<li><p><strong>hdf5</strong> <cite>Hierarchical Data Format</cite>
&lt;<a class="reference external" href="https://support.hdfgroup.org/HDF5/doc/H5.intro.html">https://support.hdfgroup.org/HDF5/doc/H5.intro.html</a>&gt; is a data
format specification that is used for the input/output format 3 in
Arepo, which is the de-facto standard I/O format (even though the
old Gadget formats are supported as well). The library is needed if
the <code class="docutils literal notranslate"><span class="pre">HAVE_HDF5</span></code> flag is set in <cite>Config.sh</cite>.</p></li>
<li><p><strong>hwloc</strong> : The <cite>hardware locality library</cite> is useful for allowing
the code to probe the processor topology it is running on and
enable a pinning of MPI threads to individual cores. This library
is optional and only required if the <code class="docutils literal notranslate"><span class="pre">IMPOSE_PINNING</span></code> flag is
set.</p></li>
</ol>
<p>Arepo needs a working C compiler supporting at least the <code class="docutils literal notranslate"><span class="pre">c11</span></code> standard, as
well as GNU-Make and Python, which are used in the build process.</p>
</section>
<section id="building-the-code">
<h2>Building the code<a class="headerlink" href="#building-the-code" title="Permalink to this headline">¶</a></h2>
<section id="systype-variable">
<h3>Systype variable<a class="headerlink" href="#systype-variable" title="Permalink to this headline">¶</a></h3>
<p>The first thing after obtaining a local copy of the code is to set a
<code class="docutils literal notranslate"><span class="pre">SYSTYPE</span></code> variable, either by typing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">SYSYTPE</span><span class="o">=</span><span class="s2">&quot;MySystype&quot;</span>
</pre></div>
</div>
<p>(assuming you run the bash-shell) or by copying the
<code class="docutils literal notranslate"><span class="pre">Template-Makefile.systype</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="n">Template</span><span class="o">-</span><span class="n">Makefile</span><span class="o">.</span><span class="n">systype</span> <span class="n">Makefile</span><span class="o">.</span><span class="n">systype</span>
</pre></div>
</div>
<p>and uncommenting the intended <code class="docutils literal notranslate"><span class="pre">SYSTYPE</span></code> variable in
<code class="docutils literal notranslate"><span class="pre">Makefile.systype</span></code>.  The <code class="docutils literal notranslate"><span class="pre">SYSTYPE</span></code> is a variable defining a
specific machine. Each machine has its specific compiler settings and
library paths defined in the Makefile. New <code class="docutils literal notranslate"><span class="pre">SYSTYPE</span></code> keywords can be
added in the Makefile when needed.</p>
</section>
<section id="config-sh-compile-time-flags">
<h3>Config.sh – Compile time flags<a class="headerlink" href="#config-sh-compile-time-flags" title="Permalink to this headline">¶</a></h3>
<p>The next step is to set the compile-time configuration of the
code. This is done best by copying the <code class="docutils literal notranslate"><span class="pre">Template-Config.sh</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="n">Template</span><span class="o">-</span><span class="n">Config</span><span class="o">.</span><span class="n">sh</span> <span class="n">Config</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>Note that the compile-time configuration file does not need to be
called <code class="docutils literal notranslate"><span class="pre">Config.sh</span></code>, however, if it is not, this needs to be
specified when calling the Makefile.  For example, for the code
examples this file is located in a different location, and they thus
make use of this possibility.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Config.sh</span></code> file enables/disables possible modules of Arepo,
such as, e.g. <code class="docutils literal notranslate"><span class="pre">SELFGRAVITY</span></code>, which switches on gravitational
interactions between cells/particles. All flags not out-commented with
a ‘#’ will be processed and cast into a <code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">MyModule</span></code> in an
automatically produced header file <code class="docutils literal notranslate"><span class="pre">arepoconfig.h</span></code> that is placed
into the code build directory.</p>
</section>
<section id="compiling-the-code">
<h3>Compiling the code<a class="headerlink" href="#compiling-the-code" title="Permalink to this headline">¶</a></h3>
<p>Arepo can be compiled with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span>
</pre></div>
</div>
<p>which will first execute a check on the compile time flags (see below)
followed by the actual build. It is also possible to skip the check by
typing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">build</span>
</pre></div>
</div>
<p>The compilation can be accelerated on multi-core machines by compiling
files in parallel with an option like <code class="docutils literal notranslate"><span class="pre">-j</span> <span class="pre">8</span></code>, which will use 8 threads
for the compilation.</p>
</section>
<section id="compile-time-checks-of-flags">
<h3>Compile-time checks of flags<a class="headerlink" href="#compile-time-checks-of-flags" title="Permalink to this headline">¶</a></h3>
<p>The normal <code class="docutils literal notranslate"><span class="pre">make</span></code> command will first execute a check using the
python script <code class="docutils literal notranslate"><span class="pre">check.py</span></code>. This ensures that all flags used in the
code via <code class="docutils literal notranslate"><span class="pre">#if</span> <span class="pre">defined(MyFlag)</span></code> or <code class="docutils literal notranslate"><span class="pre">#ifdef</span> <span class="pre">MyFlag</span></code> occur either in
<code class="docutils literal notranslate"><span class="pre">Template-Config.sh</span></code> or <code class="docutils literal notranslate"><span class="pre">defines_extra</span></code>. The main reason for doing
this is to prevent typos in the code such as <code class="docutils literal notranslate"><span class="pre">#if</span> <span class="pre">defined(MyFlg)</span></code>,
which are generally very hard to find because the code might compile
normally, but the code followed by <code class="docutils literal notranslate"><span class="pre">#if</span> <span class="pre">defined(MyFlg)</span></code> just does
not appear in the executable.</p>
<p>New flags that can be activated should be included to
<code class="docutils literal notranslate"><span class="pre">Template-Config.sh</span></code>, while internally defined flags (such as header
file guards) are listed in <code class="docutils literal notranslate"><span class="pre">defines_extra</span></code> in order to exempt them
from the check.</p>
</section>
</section>
<section id="starting-the-code">
<h2>Starting the code<a class="headerlink" href="#starting-the-code" title="Permalink to this headline">¶</a></h2>
<section id="param-txt-runtime-settings">
<h3>param.txt – Runtime settings<a class="headerlink" href="#param-txt-runtime-settings" title="Permalink to this headline">¶</a></h3>
<p>After compiling Arepo, the executable <code class="docutils literal notranslate"><span class="pre">Arepo</span></code> should be present in
the main directory. To start a simulation, Arepo needs be handed over
the path to a file containing the runtime parameters, usually called
<code class="docutils literal notranslate"><span class="pre">param.txt</span></code>.  The settings that need to be set generally depend on
the compile-time flags used. All possible parameters are listed under
<a class="reference internal" href="parameterfile.html#parameterfile"><span class="std std-ref">Parameterfile</span></a>, including the compile-time flags they belong
to. Starting Arepo with a parameter file that has too few or obsolete
parameter settings will result in an output telling which parameters
are required or still needed, respectively.</p>
</section>
<section id="starting-the-simulation">
<h3>Starting the simulation<a class="headerlink" href="#starting-the-simulation" title="Permalink to this headline">¶</a></h3>
<p>A simulation is started with a command like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mpirun</span> <span class="o">-</span><span class="n">np</span> <span class="mi">32</span> <span class="n">Arepo</span> <span class="n">param</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>which will start Arepo on 32 MPI ranks using the <code class="docutils literal notranslate"><span class="pre">param.txt</span></code> file
for the run-time parameter settings. Note that on some systems, mpirun
may instead be called mpiexec, or be another launch-command such as srun,
with a slightly different syntax. We refer to the user guide of individual
machines for such peculiarities.</p>
</section>
</section>
<section id="interrupting-a-run">
<h2>Interrupting a run<a class="headerlink" href="#interrupting-a-run" title="Permalink to this headline">¶</a></h2>
<p>Arepo supports running a simulations in several consecutive
installments, and resuming an already started simulation from
so-called restart files (a mechanism sometimes called checkpointing),
which are essentially memory dumps written to the output
directory. The code is written in such a way that the results are
completely independent of the number of restarts performed, which is a
crucial aspect for debugging the code if necessary, as this ensures
deterministic reproducability.</p>
<p>A (regular) code termination always results in the writing of such
restart files, and is normally triggered when more than 85% of the
specified maximum runtime has been reached, or when the final
simulation time has been reached.  It is important, in particular in
larger simulations, that the code is able to complete the output of
the restart file before, e.g. a job time-limit is reached. Therefore
the specified maximum runtime should never exceed the runtime limits
of the machine.</p>
<p>It is also possible to trigger a (regular) code interruption by
introducing a file called <code class="docutils literal notranslate"><span class="pre">stop</span></code> in the output directory.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">touch</span> <span class="n">stop</span>
</pre></div>
</div>
<p>Furthermore, Arepo usually produces restart-files in regular, user
specified time intervals to ensure runs can be resumed without a major
loss of computation time even if a run was terminated abruptly by the
operating system.</p>
</section>
<section id="restarting-a-run">
<h2>Restarting a run<a class="headerlink" href="#restarting-a-run" title="Permalink to this headline">¶</a></h2>
<p>A simulation can be restarted in two ways in Arepo, which is indicated with the
additional flags 1 or 2 in the execution call. The flag 1 is the restarting
from a restart file and generally recommended if possible. This, however,
has the restriction that a run needs to be resumed with <strong>exactly as many MPI
ranks</strong> as it was originally started from. The restart-command then looks
as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mpirun</span> <span class="o">-</span><span class="n">np</span> <span class="mi">32</span> <span class="o">./</span><span class="n">Arepo</span> <span class="n">param</span><span class="o">.</span><span class="n">txt</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Alternatively, a flag value of 2 signals that one wants to resume a
simulation from a regular snapshot output. This is possible but
discouraged because here the simulation results will not be binary
identical to a run without this restart. In particular in runs where
some fields (especially positions) are written in single precision,
this can also have effects on the overall quality of the simulation. A
command to restart Arepo from a snapshot looks like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mpirun</span> <span class="o">-</span><span class="n">np</span> <span class="mi">32</span> <span class="o">./</span><span class="n">Arepo</span> <span class="n">param</span><span class="o">.</span><span class="n">txt</span> <span class="mi">2</span> <span class="mi">7</span>
</pre></div>
</div>
<p>Here Arepo would read in the snapshot number 7 and resume the
simulation from its corresponding time. This second method is only
recommened if the regular start from restart files is not possible for
some reason.</p>
</section>
<section id="starting-post-processing-tasks">
<h2>Starting post-processing tasks<a class="headerlink" href="#starting-post-processing-tasks" title="Permalink to this headline">¶</a></h2>
<p>There are a number of post-processing options in the public version of
Arepo. The main ones are</p>
<ul class="simple">
<li><p>to run the halo and/or subhalo finder in post-processing (flag 3)</p></li>
<li><p>to convert a snapshot to another format (flag 6),</p></li>
<li><p>to write the Voronoi-mesh data (flag 14)</p></li>
<li><p>to calculate and output the gradients of hydrodynamical quantities (flag 17)</p></li>
<li><p>to calculate and output the gravitational potential (flag 18)</p></li>
</ul>
<p>Note that the non-continuity of the numbers originates from the goal
to maintain consistency with the developer version, which has more
options. Other flags are not supported in the current public version
of Arepo.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Arepo</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#library-requirements">Library requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-the-code">Building the code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#systype-variable">Systype variable</a></li>
<li class="toctree-l3"><a class="reference internal" href="#config-sh-compile-time-flags">Config.sh – Compile time flags</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compiling-the-code">Compiling the code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compile-time-checks-of-flags">Compile-time checks of flags</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#starting-the-code">Starting the code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#param-txt-runtime-settings">param.txt – Runtime settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#starting-the-simulation">Starting the simulation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#interrupting-a-run">Interrupting a run</a></li>
<li class="toctree-l2"><a class="reference internal" href="#restarting-a-run">Restarting a run</a></li>
<li class="toctree-l2"><a class="reference internal" href="#starting-post-processing-tasks">Starting post-processing tasks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="simtypes.html">Simulation examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="config-options.html">Code Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameterfile.html">Parameterfile</a></li>
<li class="toctree-l1"><a class="reference internal" href="snapshotformat.html">Simulation output</a></li>
<li class="toctree-l1"><a class="reference internal" href="diagnosticfiles.html">Diagnostic output</a></li>
<li class="toctree-l1"><a class="reference internal" href="migration.html">Related codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Code development</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Arepo documentation</a></li>
      <li>Next: <a href="simtypes.html" title="next chapter">Simulation examples</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Max-Planck Institute for Astrophysics.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/running.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>